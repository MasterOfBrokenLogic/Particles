<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Comet Particles</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
html, body {margin:0; padding:0; width:100%; height:100%; background:#111; overflow:hidden;}
canvas {display:block;}
</style>
<script>
document.addEventListener('contextmenu', e => e.preventDefault());
</script>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let SPACING = 2;
let PARTICLE_SIZE = 1.6;
let SWIPE_SIZE = 1.2;
let DRAG = 0.92;
let EASE = 0.015; // slower return
let COLOR_BASE = 220;
let INFLUENCE_RADIUS = 4000;
let particles = [];
let pointers = [];
let idleOffset = 0;

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  particles = [];
  const cols = Math.floor(canvas.width / SPACING);
  const rows = Math.floor(canvas.height / SPACING);
  for(let y=0; y<rows; y++){
    for(let x=0; x<cols; x++){
      particles.push({
        x: x*SPACING + SPACING/2,
        y: y*SPACING + SPACING/2,
        ox: x*SPACING + SPACING/2,
        oy: y*SPACING + SPACING/2,
        vx: 0,
        vy: 0,
        size: PARTICLE_SIZE,
        colorOffset: Math.random()*60
      });
    }
  }
}

window.addEventListener('resize', resize);
resize();

function addPointer(x,y){
  pointers.push({x,y});
}

canvas.addEventListener('mousemove', e => addPointer(e.clientX,e.clientY));
canvas.addEventListener('touchmove', e => {
  for(let t of e.touches) addPointer(t.clientX,t.clientY);
  e.preventDefault();
},{passive:false});

function step(){
  const w = canvas.width;
  const h = canvas.height;

  // fade background for smooth trails
  ctx.fillStyle = 'rgba(17,17,17,0.18)';
  ctx.fillRect(0,0,w,h);

  idleOffset += 0.001;

  for(let p of particles){
    // subtle idle drift
    let driftX = Math.sin(p.ox*0.01 + idleOffset)*0.3;
    let driftY = Math.cos(p.oy*0.01 + idleOffset)*0.3;

    // swipe influence
    let closestDistance = Infinity;
    for(let pointer of pointers){
      let dx = pointer.x - p.x;
      let dy = pointer.y - p.y;
      let d = dx*dx + dy*dy;
      if(d < INFLUENCE_RADIUS){
        closestDistance = Math.min(closestDistance, Math.sqrt(d));
        let f = -INFLUENCE_RADIUS/d;
        let angle = Math.atan2(dy,dx);
        p.vx += f*Math.cos(angle);
        p.vy += f*Math.sin(angle);
      }
    }

    // update position
    p.x += (p.vx *= DRAG) + (p.ox - p.x)*EASE + driftX;
    p.y += (p.vy *= DRAG) + (p.oy - p.y)*EASE + driftY;

    // adjust particle size for swipe
    p.size = closestDistance < 60 ? SWIPE_SIZE : PARTICLE_SIZE;
  }

  // draw particles
  for(let p of particles){
    let hue = (COLOR_BASE + p.colorOffset) % 360;
    let alpha = 0.8;
    ctx.fillStyle = `hsla(${hue}, 100%, 80%, ${alpha})`;
    ctx.fillRect(p.x,p.y,p.size,p.size);
  }

  pointers = [];
  requestAnimationFrame(step);
}

step();
</script>
</body>
</html>
