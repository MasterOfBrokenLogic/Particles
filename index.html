<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Swipe Comet Particles</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
html, body {margin:0; padding:0; width:100%; height:100%; background:#111; overflow:hidden;}
canvas {display:block;}
</style>
<script>
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.ctrlKey && (e.key==='u'||e.key==='U')) e.preventDefault();
  if(e.ctrlKey && e.shiftKey && (e.key==='I'||e.key==='i')) e.preventDefault();
  if(e.key==='F12') e.preventDefault();
});
</script>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let SPACING = 6;
let DRAG = 0.92;
let EASE = 0.15;
let COLOR = 220;
let particles = [];
let pointers = [];

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  particles = [];
  const cols = Math.floor(canvas.width / SPACING);
  const rows = Math.floor(canvas.height / SPACING);
  for(let y=0; y<rows; y++){
    for(let x=0; x<cols; x++){
      particles.push({
        x: x*SPACING + SPACING/2,
        y: y*SPACING + SPACING/2,
        ox: x*SPACING + SPACING/2,
        oy: y*SPACING + SPACING/2,
        vx: 0,
        vy: 0
      });
    }
  }
}

window.addEventListener('resize', resize);
resize();

function addPointer(x,y){
  pointers.push({x,y});
}

canvas.addEventListener('mousemove', e => addPointer(e.clientX,e.clientY));
canvas.addEventListener('touchmove', e => {
  for(let t of e.touches) addPointer(t.clientX,t.clientY);
  e.preventDefault();
},{passive:false});

function step(){
  const w = canvas.width;
  const h = canvas.height;

  ctx.fillStyle = 'rgba(17,17,17,0.25)';
  ctx.fillRect(0,0,w,h);

  // particle animation
  for(let p of particles){
    for(let pointer of pointers){
      let dx = pointer.x - p.x;
      let dy = pointer.y - p.y;
      let d = dx*dx + dy*dy;
      if(d < 2500){ // radius of effect
        let f = -2500/d;
        let angle = Math.atan2(dy,dx);
        p.vx += f*Math.cos(angle);
        p.vy += f*Math.sin(angle);
      }
    }
    p.x += (p.vx *= DRAG) + (p.ox - p.x)*EASE;
    p.y += (p.vy *= DRAG) + (p.oy - p.y)*EASE;
  }

  // draw particles
  const img = ctx.createImageData(w,h);
  const data = img.data;
  for(let p of particles){
    let n = (~~p.x + ~~p.y*w)*4;
    data[n] = data[n+1] = data[n+2] = COLOR;
    data[n+3] = 255;
  }
  ctx.putImageData(img,0,0);

  // clear pointers after frame
  pointers = [];

  requestAnimationFrame(step);
}

step();
</script>
</body>
</html>
