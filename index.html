<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Comet Particles</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
html, body {margin:0; padding:0; width:100%; height:100%; background:#111; overflow:hidden;}
canvas {display:block;}
</style>
<script>
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.ctrlKey && (e.key==='u'||e.key==='U')) e.preventDefault();
  if(e.ctrlKey && e.shiftKey && (e.key==='I'||e.key==='i')) e.preventDefault();
  if(e.key==='F12') e.preventDefault();
});
</script>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let SPACING = 4;
let particles = [];
let pointer = {x:0, y:0};
let pointerHistory = [], maxHistory = 5;
let tx, ty, man = false;

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  particles = [];
  const cols = Math.floor(canvas.width / SPACING);
  const rows = Math.floor(canvas.height / SPACING);
  for(let y=0; y<rows; y++){
    for(let x=0; x<cols; x++){
      particles.push({
        x: x*SPACING + SPACING/2,
        y: y*SPACING + SPACING/2,
        ox: x*SPACING + SPACING/2,
        oy: y*SPACING + SPACING/2,
        vx: 0,
        vy: 0
      });
    }
  }
  pointer.x = pointer.y = canvas.width/2;
  pointerHistory = [];
}

window.addEventListener('resize', resize);
resize();

canvas.addEventListener('mousemove', e => {pointer.x = e.clientX; pointer.y = e.clientY; man = true;});
canvas.addEventListener('touchmove', e => {
  const t = e.touches[0];
  pointer.x = t.clientX;
  pointer.y = t.clientY;
  man = true;
  e.preventDefault();
},{passive:false});

function step(){
  const w = canvas.width;
  const h = canvas.height;

  if(!man){
    const t = +new Date()*0.001;
    pointer.x = w*0.5 + Math.cos(t*2.1)*Math.cos(t*0.9)*w*0.45;
    pointer.y = h*0.5 + Math.sin(t*3.2)*Math.tan(Math.sin(t*0.8))*h*0.45;
  }

  pointerHistory.push({x:pointer.x, y:pointer.y});
  if(pointerHistory.length>maxHistory) pointerHistory.shift();
  const target = pointerHistory[0];

  ctx.fillStyle = 'rgba(17,17,17,0.25)';
  ctx.fillRect(0,0,w,h);

  for(let i=0;i<particles.length;i++){
    const p = particles[i];
    const dx = target.x - p.x;
    const dy = target.y - p.y;
    p.vx += dx*0.002;
    p.vy += dy*0.002;
    p.vx *= 0.92;
    p.vy *= 0.92;
    p.x += p.vx + (p.ox - p.x)*0.1;
    p.y += p.vy + (p.oy - p.y)*0.1;

    ctx.fillStyle = 'rgb(220,220,220)';
    ctx.fillRect(p.x,p.y,1,1);
  }

  requestAnimationFrame(step);
}

step();
</script>
</body>
</html>
