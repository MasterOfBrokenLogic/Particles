<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Comet Particles</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
html, body {margin:0; padding:0; width:100%; height:100%; background:#111; overflow:hidden;}
canvas {display:block;}
</style>
<script>
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.ctrlKey && (e.key==='u'||e.key==='U')) e.preventDefault();
  if(e.ctrlKey && e.shiftKey && (e.key==='I'||e.key==='i')) e.preventDefault();
  if(e.key==='F12') e.preventDefault();
});
</script>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let SPACING = 3, DRAG = 0.92, EASE = 0.18, COLOR = 220;
let particles = [], pointerHistory = [], pointerMax = 5;
let mx, my, man = false, tx, ty;

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  particles = [];
  const cols = Math.floor(canvas.width / SPACING);
  const rows = Math.floor(canvas.height / SPACING);
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      particles.push({
        x: x*SPACING + SPACING/2,
        y: y*SPACING + SPACING/2,
        ox: x*SPACING + SPACING/2,
        oy: y*SPACING + SPACING/2,
        vx: 0,
        vy: 0
      });
    }
  }
  tx = canvas.width/2;
  ty = canvas.height/2;
  pointerHistory = [];
}

window.addEventListener('resize', resize);
resize();

canvas.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; man = true; });
canvas.addEventListener('touchmove', e => {
  const t = e.touches[0];
  mx = t.clientX; my = t.clientY; man = true;
  e.preventDefault();
},{passive:false});

function step() {
  const w = canvas.width, h = canvas.height;

  if(!man){
    const t = +new Date()*0.001;
    mx = w*0.5 + Math.cos(t*2.1)*Math.cos(t*0.9)*w*0.45;
    my = h*0.5 + Math.sin(t*3.2)*Math.tan(Math.sin(t*0.8))*h*0.45;
  }

  pointerHistory.push({x: mx, y: my});
  if(pointerHistory.length > pointerMax) pointerHistory.shift();
  const target = pointerHistory[0];
  const tx = target.x;
  const ty = target.y;

  for(let i=0;i<particles.length;i++){
    const p = particles[i];
    const dx = tx - p.x;
    const dy = ty - p.y;
    const d = dx*dx + dy*dy;
    if(d < 6400){
      const f = -6400/d;
      const a = Math.atan2(dy,dx);
      p.vx += f*Math.cos(a);
      p.vy += f*Math.sin(a);
    }
    p.x += (p.vx *= DRAG) + (p.ox - p.x)*EASE;
    p.y += (p.vy *= DRAG) + (p.oy - p.y)*EASE;
  }

  ctx.fillStyle = 'rgba(17,17,17,0.25)';
  ctx.fillRect(0,0,w,h);

  const img = ctx.createImageData(w,h);
  const data = img.data;
  for(let i=0;i<particles.length;i++){
    const p = particles[i];
    const n = (~~p.x + ~~p.y*w)*4;
    data[n] = data[n+1] = data[n+2] = COLOR;
    data[n+3] = 255;
  }
  ctx.putImageData(img,0,0);

  requestAnimationFrame(step);
}

step();
</script>
</body>
</html>
