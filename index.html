<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Free Swipe Comet Particles</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<style>
html, body {margin:0; padding:0; width:100%; height:100%; background:#111; overflow:hidden;}
canvas {display:block;}
</style>
<script>
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.ctrlKey && (e.key==='u'||e.key==='U')) e.preventDefault();
  if(e.ctrlKey && e.shiftKey && (e.key==='I'||e.key==='i')) e.preventDefault();
  if(e.key==='F12') e.preventDefault();
});
</script>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let SPACING = 4;
let particles = [];
let swipes = [];
const trailLength = 10;

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  particles = [];
  const cols = Math.floor(canvas.width / SPACING);
  const rows = Math.floor(canvas.height / SPACING);
  for(let y=0; y<rows; y++){
    for(let x=0; x<cols; x++){
      particles.push({
        x: x*SPACING + SPACING/2,
        y: y*SPACING + SPACING/2,
        ox: x*SPACING + SPACING/2,
        oy: y*SPACING + SPACING/2
      });
    }
  }
}

window.addEventListener('resize', resize);
resize();

function addSwipe(x,y){
  swipes.push({history: [{x,y}], vx:0, vy:0});
}

canvas.addEventListener('mousemove', e => {addSwipe(e.clientX,e.clientY);});
canvas.addEventListener('touchmove', e => {
  for(let t of e.touches) addSwipe(t.clientX,t.clientY);
  e.preventDefault();
},{passive:false});

function step(){
  const w = canvas.width;
  const h = canvas.height;

  ctx.fillStyle = 'rgba(17,17,17,0.2)'; // slight fade for trail
  ctx.fillRect(0,0,w,h);

  // draw static field
  ctx.fillStyle = 'rgb(220,220,220)';
  for(let p of particles){
    ctx.fillRect(p.x,p.y,0.5,0.5);
  }

  // process swipes
  for(let swipe of swipes){
    let hx = swipe.history[swipe.history.length-1].x;
    let hy = swipe.history[swipe.history.length-1].y;

    swipe.vx *= 0.92;
    swipe.vy *= 0.92;

    // move along last direction
    if(swipe.history.length>1){
      const prev = swipe.history[swipe.history.length-2];
      swipe.vx += (hx - prev.x)*0.2;
      swipe.vy += (hy - prev.y)*0.2;
    }

    hx += swipe.vx;
    hy += swipe.vy;

    swipe.history.push({x:hx, y:hy});
    if(swipe.history.length>trailLength) swipe.history.shift();

    // draw trail
    for(let i=0;i<swipe.history.length;i++){
      const t = swipe.history[i];
      ctx.fillStyle = `rgba(220,220,220,${i/trailLength})`;
      ctx.fillRect(t.x,t.y,1,1);
    }
  }

  requestAnimationFrame(step);
}

step();
</script>
</body>
</html>
